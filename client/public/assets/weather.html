<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>weather</title>
    <script type="text/javascript">
        function getQueryVariable(variable)
        {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }
        const lat = getQueryVariable("lat");
        const lng = getQueryVariable("lng");
    </script>
</head>
<body style="margin:0px">
    <div id="wapp"></div>
    
    <script type="text/javascript">
    const wapp = document.getElementById("wapp");
    wapp.innerHTML=`<div
                data-windywidget="forecast"
                data-lat="${lat}"
                data-lng="${lng}"
                data-appid="9d6a0fea1052599fa99b25d622cca5ae">
                </div>`;
    (function(window, document){

var WindyForecastAsync = function(opts, node) {

    this.url = 'https://windy.app/widget/';

    // require once
    if(!document.querySelector('.windy-forecast')) {

        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = this.url + 'dark.css?v8';
        document.head.appendChild(link);

        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = this.url + 'widget.css?v8';
        document.head.appendChild(link);

    }

    function showHtmlTemplate(spotInfo, data, node, opts) {

        var ts = new Date().getTime() / 1000;
        var spotUrl = spotInfo.spotUrl + '/' + spotInfo.spotName;
        var spotName = spotInfo.spotName;
        var spotGmtOffset = spotInfo.spotGmtOffset;
        var spotTimezone = spotInfo.spotTimezone;
        var favoriteCount = spotInfo.favoriteCount;
        var spotID = spotInfo.spotID;
        var spotTime = spotInfo.spotTime;

        var html = '<div class="windy-forecast" id="widget_' + spotID + '">';
        html += '<div id="windywidgetheader">';
        html += '<table width="100%" cellspacing="0" cellpadding="0" border="0">';
        html += '<tr>';
        html += '<td class="windywidgetcurwindDirection"><img style="transform: rotate(' + data[0].windDirection + 'deg); -webkit-transform: rotate(' + data[0].windDirection + 'deg);max-width:45px" src="https://windy.app/widget/img/cws-arr.svg" width="45" height="35"></td>';
        html += '<td style="vertical-align: middle;padding-left:12px;" class="windywidgetheaderText" width="100%">';
        html += '<span id="windywidgetcurwindSpeed" data-value="' + data[0].windSpeed + '"></span> <span id="windywidgetcurwindspeedUnit" onclick="updateWind (' + spotID + ');">m/s</span>';
        html += '<a id="windywidgetspotname" target="__blank" href="' + spotUrl + '" onclick="ga(\'send\', \'event\', \'' + (opts.appid == 'windyapp' ? 'site_' : '') + 'widget_button\', \'go_to_site\', \'site_spot\');">' + spotName + '</a><br>';
        html += '<div class="windywidgettimezone" style="float:left;">' + spotTime + ', GMT' + spotGmtOffset + '</div>';
        html += '</td>';
        html += '<td nowrap="1" class="windywidgetfavoriteCount" style="vertical-align: top; padding-top: 11px"><img src="https://windy.app/widget/img/star.svg" style="width:19px;height:19px;max-width:19px"/></td>';
        html += '<td nowrap="1" class="windywidgetfavoriteCount" style="vertical-align: top; padding-top: 11px">' + favoriteCount + '</td>';
        html += '</tr>';
        html += '</table>';
        html += '</div>';
        html += '<div id="windywidgetmain">';
        html += '<div id="windywidgetdates"></div>';
        html += '<div id="windywidgetslider"><div></div></div>';
        html += '<div style="clear:both;height:1px"></div>';
        html += '<div id="windywidgetlegend"><table><tr class="windywidgetdays"><td></td></tr><tr class="windywidgethours"><td><a title="' + spotTimezone + '" style="cursor: pointer;">Time</a></td></tr><tr class="windywidgetwindDirection"><td>Wind direction</td></tr><tr class="windywidgetwindSpeed"><td onclick="updateWind (' + spotID + ');">Wind speed (km/h)<div></div></td></tr><tr class="windywidgetwindGust"><td onclick="updateWind (' + spotID + ');">Wind gusts (km/h)<div></div></td></tr><tr class="windywidgetairTemp"><td onclick="updateTemp (' + spotID + ');"></td></tr><tr class="windywidgetairPres"><td><a title="Air pressure at sea level" style="cursor: pointer;">Air pressure (mmHg)</a></td></tr><tr class="windywidgetclouds"><td><a title="Cloud cover high / mid/ low" style="cursor: pointer;">Cloud coverage</a></td></tr><tr class="windywidgetprecipitation"><td><a title="Precipitation mm/3h" style="cursor: pointer;">Precipitation (mm/3h)</div></a></td></tr><tr class="windywidgetwaves"><td>Waves direction</td></tr><tr class="windywidgetwavesheight"><td onclick="updateHeight (' + spotID + ');"></td></tr><tr class="windywidgetwavesperiod"><td><a title="Waves period, sec" style="cursor: pointer;">Waves period (s)</a></td></tr><tr class="windywidgettides"><td title="Tides, m/ft" style="cursor: pointer;" onclick="updateHeight (' + spotID + ')"></td></tr></table></div>';
        html += '<div id="windywidgettable"></div>';
        html += '<div id="windywidgetclear" style="clear:both;"></div>';
        html += '<div class="windywidgetApps"><a target="__blank" href="https://windy.app.link/' + (opts.appid != 'windyapp' ? 'widget-':'') + 'download-windy-android" onclick="ga(\'send\', \'event\', \'' + (opts.appid == 'windyapp' ? 'site_' : '') + 'widget_button\', \'go_to_store\', \'android\');"><img src="https://windy.app/widget/img/g.svg" width="75" alt="Get it on Google Play"></a>&nbsp;&nbsp;&nbsp;&nbsp;<a target="__blank" href="https://windy.app.link/' + (opts.appid != 'windyapp' ? 'widget-':'') + 'download-windy-ios" onclick="ga(\'send\', \'event\', \'' + (opts.appid == 'windyapp' ? 'site_' : '' ) + 'widget_button\', \'go_to_store\', \'android\');"><img src="https://windy.app/widget/img/a.svg" width="75" alt="Download on the Appstore"></a>&nbsp;&nbsp;&nbsp;&nbsp;</div>';
        html += '<div class="windywidgetpoweredBy"><a target="__blank" href="https://windy.app" onclick="ga(\'send\', \'event\', \'' + (opts.appid == 'windyapp' ? 'site_' : '') + 'widget_button\', \'go_to_site\', \'site\');"><img src="https://windy.app/widget/img/w3.svg" width="100" height="23" alt="WINDY.APP"></a></div>';
        html += '<div id="windywidgetclear" style="clear:both;"></div>';
        html += '</div>';
        html += '</div>';
        
        node.innerHTML = html;
        
    }


    // Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸ Ð¸ Ð¿Ð¾Ñ€Ñ‹Ð²Ð¾Ð² Ð²ÐµÑ‚Ñ€Ð°, Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Ð¼ÐµÑ‚Ñ€Ð°Ñ… Ð² ÑÐµÐºÑƒÐ½Ð´Ñƒ
    function colorForWindSpeed (speed) {
        var h = 0;
        var lowind = 1;
        var sat = 0.8;
        var br = 0.85;


        if (speed < 3.0) {
            lowind = 1.0 - Math.sqrt (1.0 - 3.0 / 5.5);
            sat = 0.55;
            br = 0.65;
        } else if (speed < 5.5) {
            lowind = 1.0 - Math.sqrt (1.0 - speed / 5.5);
            sat = 0.55 + 0.25 * ((speed - 3) / 2.5);
            br = 0.65 + 0.2 * ((speed - 3) / 2.5);
        } else if (speed > 12.0) {
            lowind = 1.0 - (speed - 12.0) / speed * 1.0 / 2.0;
        }

        var sv = speed / 25.0;

        if (sv > 1.0) sv = 1.0;

        h = (1.0 - sv * lowind) + 0.5833;

        if (h > 1.0) {
            h -= 1.0;
        }

        // convert HSB to HSL
        // http://stackoverflow.com/a/31322679/2207790
        var l = (2 - sat) * br / 2;
        sat = l&&l<1 ? sat * br / (l < 0.5 ? l * 2 : 2 - l * 2) : sat;

        return 'hsl(' + Math.round (h * 360) + ',' + Math.round (sat * 100) + '%,' + Math.round (l * 100) + '%)';
    }

    // Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñ‹, Ð²Ñ…Ð¾Ð´Ð½Ð¾Ð¹ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð² Ð³Ñ€Ð°Ð´ÑƒÑÐ°Ñ… Ñ†ÐµÐ»ÑŒÑÐ¸Ñ
    function colorForTemperature(tempCelsium) {
        var brightness = 0.8;
        var sat = 1.0;

        var coldVal = 240.0 / 360.0;
        var bestVal = 190.0 / 360.0;
        var bestPlusVal = 70.0 / 360.0;
        var hotVal = 0.0 / 360.0;

        var coldTemp = -20;
        var bestTemp = 0;
        var hotTemp = 40;
        var val = 0.0;

        if (tempCelsium < coldTemp) {
            tempCelsium = coldTemp;
        } else if (tempCelsium > hotTemp) {
            tempCelsium = hotTemp;
        }

        if (tempCelsium <= bestTemp) {
            val = ((tempCelsium - coldTemp) / (bestTemp - coldTemp)) * (bestVal - coldVal) + coldVal;
        } else if (tempCelsium > bestTemp) {
            val = ((tempCelsium - bestTemp) / (hotTemp - bestTemp)) * (hotVal - bestPlusVal) + bestPlusVal;
        }

        if (tempCelsium > 10.0) {
            brightness = 1.0;
            sat = 0.5 + Math.pow(Math.abs(tempCelsium - 10), 1.0 / 2.0) / 30.0;
        } else if (tempCelsium > 0.0) {
            brightness = 1.0;
            sat = 0.15 + Math.pow(Math.abs(tempCelsium), 1.0 / 3.0) / 6.15;
        } else {
            brightness = 1.0 - Math.sqrt(Math.sqrt(Math.abs(tempCelsium))) / 100.0;
            sat = 0.2 + Math.sqrt(Math.sqrt(Math.abs(tempCelsium))) / 4.0;
        }

        // convert HSB to HSL
        // http://stackoverflow.com/a/31322679/2207790
        var l = (2 - sat) * brightness / 2;
        sat = l && l < 1 ? sat * brightness / (l < 0.5 ? l * 2 : 2 - l * 2) : sat;

        return 'hsla(' + Math.round(val * 360) + ',' + Math.round(sat * 100) + '%,' + Math.round(l * 100) + '%,1.0)';
    }

    // Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ, Ð²Ñ…Ð¾Ð´Ð½Ð¾Ð¹ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð² mmHg
    function colorForPressure(mmHg) {
        var brightness = 0.8;
        var sat = 1.0;

        var coldVal = 240.0 / 360.0;
        var bestVal = 190.0 / 360.0;
        var bestPlusVal = 70.0 / 360.0;
        var hotVal = 0.0 / 360.0;

        var coldTemp = -20;
        var bestTemp = 0;
        var hotTemp = 40;
        var val = 0.0;

        if (mmHg < coldTemp) {
            mmHg = coldTemp;
        } else if (mmHg > hotTemp) {
            mmHg = hotTemp;
        }

        if (mmHg <= bestTemp) {
            val = ((mmHg - coldTemp) / (bestTemp - coldTemp)) * (bestVal - coldVal) + coldVal;
        } else if (mmHg > bestTemp) {
            val = ((mmHg - bestTemp) / (hotTemp - bestTemp)) * (hotVal - bestPlusVal) + bestPlusVal;
        }

        if (mmHg > 10.0) {
            brightness = 1.0;
            sat = 0.5 + Math.pow(Math.abs(mmHg - 10), 1.0 / 2.0) / 30.0;
        } else if (mmHg > 0.0) {
            brightness = 1.0;
            sat = 0.15 + Math.pow(Math.abs(mmHg), 1.0 / 3.0) / 6.15;
        } else {
            brightness = 1.0 - Math.sqrt(Math.sqrt(Math.abs(mmHg))) / 100.0;
            sat = 0.2 + Math.sqrt(Math.sqrt(Math.abs(mmHg))) / 4.0;
        }

        // convert HSB to HSL
        // http://stackoverflow.com/a/31322679/2207790
        var l = (2 - sat) * brightness / 2;
        sat = l && l < 1 ? sat * brightness / (l < 0.5 ? l * 2 : 2 - l * 2) : sat;

        return 'hsla(' + Math.round(val * 360) + ',' + Math.round(sat * 100) + '%,' + Math.round(l * 100) + '%,1.0)';
    }

    function colorForClouds(cloudsCover) {
        var brightness = 1;
        var sat = 0;
        var val = 0;

        brightness = brightness - cloudsCover / 300;

        // convert HSB to HSL
        // http://stackoverflow.com/a/31322679/2207790
        var l = (2 - sat) * brightness / 2;
        sat = l && l < 1 ? sat * brightness / (l < 0.5 ? l * 2 : 2 - l * 2) : sat;

        var alpha = 1.0;
        alpha = cloudsCover / 100.0;

        return 'hsla(' + Math.round(val * 360) + ',' + Math.round(sat * 100) + '%,' + Math.round(l * 100) + '%, ' + alpha + ')';
    }


    // //www.mvps.org/directx/articles/catmull/
    function spline(P0, P1, P2, P3, t) {
        return 0.5 * ((2 * P1) + (-P0 + P2) * t + (2 * P0 - 5 * P1 + 4 * P2 - P3) * t * t + (-P0 + 3 * P1 - 3 * P2 + P3) * t * t * t);
    }

    // Ð’Ñ‹ÑÐ¾Ñ‚Ð° ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð¸ÐºÐ° - 4.0Ð¼Ð¼ Ð²ÑÐµ Ñ‡Ñ‚Ð¾ Ð²Ñ‹ÑˆÐµ - Ð¿Ñ€Ð¾ÑÑ‚Ð¾ ÑƒÐ¿Ð¸Ñ€Ð°ÐµÑ‚ÑÑ Ð² ÐµÐ³Ð¾ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñƒ.
    // ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚Ð¸ÐºÐ° 0.2
    function precipitationToHeight(precipitation) {
        return (4 - precipitation) / (4 - 0.2);
    }

    // ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ†Ð¸Ñ„Ñ€:
    // Ð’ÑÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð¾ 10. - Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð´Ð¾ Ð´ÐµÑÑÑ‚Ñ‹Ñ… (7.5 4.0)
    // Ð’ÑÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð±Ð¾Ð»ÑŒÑˆÐµ 10 - Ñ†ÐµÐ»Ñ‹Ð¼Ð¸ (21 Ð²Ð¼ÐµÑÑ‚Ð¾ 21.5 Ð¸ Ñ‚.Ð´.)
    function num2str(n) {
        if (n < 10 && n > -10) return n.toFixed(1);
        return '' + Math.round(n);
    }

    var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

    function date2month(d) {
        return monthNames[d.getUTCMonth()];
    }

    var dayNames = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];

    function date2day(d) {
        return dayNames[d.getUTCDay()];
    }

    // m/s Ð·Ð°Ð¼ÐµÐ½ÑÑŽÑ‚ÑÑ Ð½Ð° mph, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð½Ð° ÐºÐ¼Ñ‡, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð½Ð° ÑƒÐ·Ð»Ñ‹, Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð½Ð° Ð±Ð¾Ñ„Ð¾Ñ€Ñ‚Ñ‹ Ð¸ Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ Ð½Ð° m/s
    window.updateWind = function (spotID) {
        var units = ['knots', 'bft', 'm/s', 'mph', 'km/h'];
        var tdws = document.querySelectorAll('#widget_' + spotID + ' .windywidgetwindSpeed td');
        var tdwg = document.querySelectorAll('#widget_' + spotID + ' .windywidgetwindGust td');
        var tdcws = document.querySelectorAll('#widget_' + spotID + ' #windywidgetcurwindSpeed');
        var tdcwsu = document.querySelectorAll('#widget_' + spotID + ' #windywidgetcurwindspeedUnit');
        var next = (units.indexOf(tdws[0].textContent.match(/\(([a-z/]+)\)/)[1]) + 1) % units.length;
        tdws[0].innerHTML = 'Wind speed (' + units[next] + ')';
        tdwg[0].innerHTML = 'Wind gusts (' + units[next] + ')';
        tdcwsu[0].innerHTML = units[next];
        var convert = [
            function (mps) {
                return mps * 1.94;
            },
            function (mps) {
                if(mps <= 0.3) { return 0; } else
                if(mps <= 1.6) { return 1; } else
                if(mps <= 3.4) { return 2; } else
                if(mps <= 5.5) { return 3; } else
                if(mps <= 8.0) { return 4; } else
                if(mps <= 10.8) { return 5; } else
                if(mps <= 13.9) { return 6; } else
                if(mps <= 17.2) { return 7; } else
                if(mps <= 20.8) { return 8; } else
                if(mps <= 24.5) { return 9; } else
                if(mps <= 28.5) { return 10; } else
                if(mps <= 32.7) { return 11; } else
                { return 12; }
            },
            function (mps) {
                return mps;
            },
            function (mps) {
                return mps * 2.24;
            },
            function (mps) {
                return mps * 3.6;
            },
        ];
        tdcws_val = convert[next](parseFloat(tdcws[0].dataset.value));
        tdcws[0].innerHTML = units[next] != 'bft' ? num2str(tdcws_val) : tdcws_val;
        for (var i = 1; i < tdws.length; i++) {
            var tdws_val = convert[next](parseFloat(tdws[i].dataset.value));
            var tdwg_val = convert[next](parseFloat(tdwg[i].dataset.value));
            if(units[next] != 'bft') {
                tdws_val = num2str(tdws_val);
                tdwg_val = num2str(tdwg_val);
            }                    
            tdws[i].innerHTML = tdws_val;
            tdwg[i].innerHTML = tdwg_val;
        }
    };

    // Ð° ÐµÑÐ»Ð¸ Ð¿Ð¾ Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ðµ ÐºÐ»Ð°Ñ† - Ñ‚Ð¾ Ð¾Ð½Ð° ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ñ„Ð°Ñ€ÐµÐ½Ð³ÐµÐ¹Ñ‚Ð¾Ð¼ Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ñ†ÐµÐ»ÑŒÑÐ¸ÐµÐ¼ Ð¸ Ñ‚Ð°Ðº Ð¿Ð¾ ÐºÑ€ÑƒÐ³Ñƒ
    window.updateTemp = function (spotID) {
        var units = ['C', 'F'];
        var td = document.querySelectorAll('#widget_' + spotID + ' .windywidgetairTemp td');
        var next = (units.indexOf(td[0].textContent.substr(-2, 1)) + 1) % units.length;
        td[0].innerHTML = 'Temperature (&deg;' + units[next] + ')';
        var convert = [
            function (c) {
                return c;
            },
            function (c) {
                return c * 1.8 + 32;
            }
        ];
        for (var i = 1; i < td.length; i++) {
            td[i].innerHTML = num2str(convert[next](parseFloat(td[i].dataset.value))) + '&deg;';
        }
    };

    // Ð° ÐµÑÐ»Ð¸ Ð¿Ð¾ Ð²Ñ‹ÑÐ¾Ñ‚Ðµ ÐºÐ»Ð°Ñ† - Ñ‚Ð¾ Ð¾Ð½Ð° ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑÑ Ñ„ÑƒÑ‚Ð¾Ð¼ Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ Ð¼ÐµÑ‚Ñ€Ð¾Ð¼ Ð¸ Ñ‚Ð°Ðº Ð¿Ð¾ ÐºÑ€ÑƒÐ³Ñƒ
    window.updateHeight = function (spotID) {
        var units = ['m', 'ft'];
        var tdwh = document.querySelectorAll('#widget_' + spotID + ' .windywidgetwavesheight td');
        var tdti = document.querySelectorAll('#widget_' + spotID + ' .windywidgettideInfo');
        var next = (units.indexOf(tdwh[0].textContent.substr(-2, 1)) + 1) % units.length;
        tdwh[0].innerHTML = 'Waves height (' + units[next] + ')';
        document.querySelector('#widget_' + spotID + ' .windywidgettides td').innerHTML = 'Tides (' + units[next] + ')';
        var convert = [
            function (c) {
                return c;
            },
            function (c) {
                return c * 3.28084;
            }
        ];
        for (var i = 1; i < tdwh.length; i++) {
            if(tdwh[i].dataset.value != 'false') {
                tdwh[i].innerHTML = num2str(convert[next](parseFloat(tdwh[i].dataset.value)));
            }
        }
        for (var i = 0; i < tdti.length; i++) {
            tdti[i].innerHTML = tdti[i].dataset.time + ' ' + num2str(convert[next](parseFloat(tdti[i].dataset.height))) + units[next];
                                
        }
    };
    
    window.showTides = function(show, spotID) {
        var els = document.querySelectorAll('#widget_' + spotID + ' .windywidgettides, ' +
            '#widget_' + spotID + ' .windywidgettideInfo');
        for (var i=0; i<els.length; ++i) {
          els[i].style.display = show ? '' : 'none';
        }
    }

    window.showWaves = function(show, spotID) {
        var els = document.querySelectorAll('#widget_' + spotID + ' .windywidgetwaves,' +
            '#widget_' + spotID + ' .windywidgetwavesheight,' + 
            '#widget_' + spotID + ' .windywidgetwavesperiod');
        for (var i=0; i<els.length; ++i) {
          els[i].style.display = show ? '' : 'none';
        }
    }

    var showForecast = function(data, tides, spotID) {
        var canvas = document.createElement('canvas');
        canvas.width = 32;
        canvas.height = 45;
        var context = canvas.getContext('2d');

        var dates = '<table><tr>', dates_i = 0;
        var days = '<tr class="windywidgetdays">';
        var hours = '<tr class="windywidgethours">';
        var windDirection = '<tr class="windywidgetwindDirection">';
        var windSpeed = '<tr class="windywidgetwindSpeed">';
        var windGust = '<tr class="windywidgetwindGust">';
        var airTemp = '<tr class="windywidgetairTemp">';
        var airPres = '<tr class="windywidgetairPres">';
        var cloudsHigh = '<tr class="windywidgetclouds">';
        var cloudsMid = '<tr class="windywidgetclouds">';
        var cloudsLow = '<tr class="windywidgetclouds">';
        var precipitation = '<tr class="windywidgetprecipitation">';
        var waves = '<tr class="windywidgetwaves">';
        var wavesHeight = '<tr class="windywidgetwavesheight">';
        var wavesPeriod = '<tr class="windywidgetwavesperiod">';

        var sliderGradient = [];
        
        var hasWavesData = false;
        var hasTidesData = false;


        /************
         * Waves
         ************/

        // max height for waves
        // it's better to have it in spotInfo
        var maxWavesHeight = 0;
        for (var i = 0; i < data.length; i++) {
            if(data[i].wavesHeight > maxWavesHeight)
                maxWavesHeight = data[i].wavesHeight;
        }
        

        /************
         * Tides
         ************/

        // settings
        var tideUpColor = '#2f9328';
        var tideDownColor = '#2e688e';
        var tideCurveColor = '#0070c0';
        var tideTextColor = '#bbb';
        var tideTextFont = '10px Arial';

        // finding peaks
        var tidePeaks = [];
        for(var i = 1; i < tides.length - 1; ++i) {
            if (Math.abs(tides[i-1].tideHeight) <= Math.abs(tides[i].tideHeight) &&
                Math.abs(tides[i].tideHeight) > Math.abs(tides[i+1].tideHeight) ) {
                tides[i].tideHeight = -tides[i].tideHeight;
                tidePeaks.push(tides[i]);
                if(!hasTidesData) {
                    hasTidesData = Math.abs(Math.round(tides[i].tideHeight * 10, 1)) > 0;
                }
            }
        }
        
        // init
        var tideCnv = document.createElement('canvas');
        tideCnv.width = data.length * canvas.width;
        tideCnv.height = 100;
        var tideCtx = tideCnv.getContext('2d');
    
        // calculate curve
        var tideCurve = [];
        var stepX = tideCnv.width / tidePeaks.length + 3;
        var x = 0;

        for(var i=0; i<tidePeaks.length; i++) {

            x = stepX * i;

            var P0 = tidePeaks[Math.max(i - 2, 0)].tideHeight * 30 + 50;
            var P1 = tidePeaks[Math.max(i - 1, 0)].tideHeight * 30 + 50;
            var P2 = tidePeaks[i].tideHeight * 30 + 50;
            var P3 = tidePeaks[Math.min(i + 1, tidePeaks.length - 1)].tideHeight * 30 + 50;
            var P4 = tidePeaks[Math.min(i + 2, tidePeaks.length - 1)].tideHeight * 30 + 50;

            for (var t = 5; t < 10; t++) {
                tideCurve.push({
                    "x": x - stepX + (stepX * t/10),
                    "y": spline(P0, P1, P2, P3, t/10)
                });
            }

            for (var t = 0; t < 5; t++) {
                tideCurve.push({
                    "x": x + (stepX * t/10),
                    "y": spline(P1, P2, P3, P4, t/10)
                });
            }
            
            tidePeaks[i].x = x;
            tidePeaks[i].y = P2;
        }

        // draw regions
        tideCtx.fillStyle = '#28465a';
        tideCtx.beginPath();
        tideCtx.moveTo(0, tideCnv.height/2);

        var x = 0, y = 0;
        var up = upSwitch = false;
        var tl = tideCurve.length

        for(var i=0; i<tl; i++) {

            x = tideCurve[i].x;
            y = tideCurve[i].y;
            up = (i < tl-1 && y > tideCurve[i+1].y);

            if(up != upSwitch && i<tl-1 && i>1 && y != tideCurve[i-1].y) {

                tideCtx.fillStyle = up ? tideDownColor : tideUpColor;
                tideCtx.lineTo(tideCurve[i+1].x, tideCurve[i+1].y);
                tideCtx.lineTo(tideCurve[i+1].x, tideCnv.height/2);
                tideCtx.fill();
                tideCtx.closePath();
                tideCtx.beginPath();
                tideCtx.moveTo(x, tideCnv.height/2);
                upSwitch = up;

            }

            tideCtx.lineTo(x, y);
        }

        tideCtx.lineTo(tideCnv.width, tideCnv.height/2);
        tideCtx.fill();
        tideCtx.closePath();

        // main stroke
        tideCtx.beginPath();
        for(var i=0; i<tl; i++) {
            tideCtx.lineTo(tideCurve[i].x, tideCurve[i].y);
        }
        tideCtx.shadowBlur = 1;
        tideCtx.shadowColor= '#000';
        tideCtx.strokeStyle = tideCurveColor;
        tideCtx.lineWidth = 2;
        tideCtx.stroke();
        tideCtx.closePath();
        
        // dashed center line
        tideCtx.strokeStyle = '#fff';
        tideCtx.setLineDash([5]);
        tideCtx.beginPath();
        tideCtx.moveTo(0, tideCnv.height/2);
        tideCtx.lineWidth = 1;
        tideCtx.lineTo(tideCnv.width, tideCnv.height/2);
        tideCtx.stroke();
        tideCtx.setLineDash([]);

        // info
        tideInfo = [];
        tideInfoHtml = '';
        for(var i=0; i<tidePeaks.length-1; i++) {
            if(tidePeaks[i].x) {
                var th = tidePeaks[i].tideHeight;
                var time = new Date(tidePeaks[i].timestamp * 1000);
                time = time.getHours() + ':' + ('0' + time.getMinutes()).slice(-2);
                var height = Number(-th).toFixed(1);
                var top = Math.round(tidePeaks[i].y) + (th > 0 ? 12 : -5);
                if(top > 98) top = 98;
                if(top < 8) top = 8;
                tideInfoHtml += '<div class="windywidgettideInfo" ' +
                                'style="left:' + (Math.round(tidePeaks[i].x) - 25) + 'px; top:' + top + 'px;" ' +
                                'data-time="' + time + '" data-height="' + height + '"></div>';
            }
        }

        var tidesHtml = '<tr class="windywidgettides">';

        var tmpCnv = document.createElement('canvas');
        tmpCnv.width = 32;
        tmpCnv.height = 100;
        var tmpCtx = tmpCnv.getContext('2d');
        var dows = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];


        // main loop
        for (var i = 0, j = 1, curDay = 0; i < data.length; i++) {

            var date1 = new Date(data[i].timestamp * 1000);
            var date2 = new Date(data[Math.min(i + 1, data.length - 1)].timestamp * 1000);

            var dayEnds = date1.getUTCDay() != date2.getUTCDay();

            // days
            if (dayEnds || (i == data.length - 1)) {
                var date0 = new Date(data[dates_i].timestamp * 1000);
                var newMonth = (i == 0) || (date0.getUTCMonth() != date1.getUTCMonth());

                dates += '<td width="' + Math.floor(100 * (i + 1 - dates_i) / data.length) + '%">' +
                    (newMonth ? date2month(date1) + '&nbsp;' : '') + date1.getUTCDate() + '</td>';
                dates_i = i;
                
                textDate = dows[date1.getUTCDay()] + ', ' + String(date2month(date1)).toUpperCase() + ' ' + date1.getUTCDate();
                
                days += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') +
                    ' colspan="' + j + '" style="width: ' + (32 * j) + 'px"><div>';                        
                    
                if(curDay == 0) {
                    days += 'TODAY';
                } else if(curDay == 1) {
                    days += 'TOMORROW';
                } else {
                    days += (j > 1) ? textDate : '';
                }
                curDay++;
                days += '</div></td>';
                j = 1;
            } else {
                j++;
            }

            // hours
            var night = '';
            if (data[i].nightEnd > data[i].nightStart) {
                if (data[i].nightEnd - data[i].nightStart == 1) {
                    night = ' id="windywidgetnight"';
                } else {
                    if (data[i].nightEnd < 1) {
                        var pct = Math.floor(100 * data[i].nightEnd);
                        night = ' style="background: linear-gradient(to right, #203747, #203747 ' + pct + '%, transparent ' + (pct + 1) + '%, transparent)"';
                    } else {
                        var pct = Math.floor(100 * data[i].nightStart);
                        night = ' style="background: linear-gradient(to right, transparent, transparent ' + pct + '%, #203747 ' + (pct + 1) + '%, #203747)"';
                    }
                }
            }
            hours += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + night + '>' + ('0' + date1.getUTCHours()).substr(-2) + '</td>';

            // wind direction
            windDirection += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') +
                ' style="transform: rotate(' + data[i].windDirection + 'deg); -webkit-transform: rotate(' + data[i].windDirection + 'deg)">&#8593;</td>';

            // wind speed
            var windSpeedColor1 = colorForWindSpeed(0.5 * (data[i].windSpeed + data[Math.max(i - 1, 0)].windSpeed));
            var windSpeedColor2 = colorForWindSpeed(data[i].windSpeed);
            var windSpeedColor3 = colorForWindSpeed(0.5 * (data[i].windSpeed + data[Math.min(i + 1, data.length - 1)].windSpeed));
            windSpeed += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                windSpeedColor1 + ', ' + windSpeedColor2 + ', ' + windSpeedColor3 + ')" data-value="' + data[i].windSpeed + '"></td>';

            sliderGradient.push(windSpeedColor2);

            // wind gust
            var windGustColor1 = colorForWindSpeed(0.5 * (data[i].windGust + data[Math.max(i - 1, 0)].windGust));
            var windGustColor2 = colorForWindSpeed(data[i].windGust);
            var windGustColor3 = colorForWindSpeed(0.5 * (data[i].windGust + data[Math.min(i + 1, data.length - 1)].windGust));
            windGust += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                windGustColor1 + ', ' + windGustColor2 + ', ' + windGustColor3 + ')" data-value="' + data[i].windGust + '"></td>';

            // air temperature
            var airTempColor1 = colorForTemperature(0.5 * (data[i].airTemp + data[Math.max(i - 1, 0)].airTemp));
            var airTempColor2 = colorForTemperature(data[i].airTemp);
            var airTempColor3 = colorForTemperature(0.5 * (data[i].airTemp + data[Math.min(i + 1, data.length - 1)].airTemp));
            airTemp += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                airTempColor1 + ', ' + airTempColor2 + ', ' + airTempColor3 + ')" data-value="' + data[i].airTemp + '"></td>';

            // air pressure
            var airPresColor1 = colorForPressure(0.5 * (data[i].airPres + data[Math.max(i - 1, 0)].airPres));
            var airPresColor2 = colorForPressure(data[i].airPres);
            var airPresColor3 = colorForPressure(0.5 * (data[i].airPres + data[Math.min(i + 1, data.length - 1)].airPres));
            airPres += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                airPresColor1 + ', ' + airPresColor2 + ', ' + airPresColor3 + ')">' + data[i].airPres + '</td>';

            // cloud high
            var CloudsHighColor1 = colorForClouds(0.5 * (data[i].cloudsHigh + data[Math.max(i - 1, 0)].cloudsHigh));
            var CloudsHighColor2 = colorForClouds(data[i].cloudsHigh);
            var CloudsHighColor3 = colorForClouds(0.5 * (data[i].cloudsHigh + data[Math.min(i + 1, data.length - 1)].cloudsHigh));
            cloudsHigh += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                CloudsHighColor1 + ', ' + CloudsHighColor2 + ', ' + CloudsHighColor3 + ')" data-value="' + data[i].cloudsHigh + '"></td>';


            // cloud medium
            var CloudsMidColor1 = colorForClouds(0.5 * (data[i].cloudsMid + data[Math.max(i - 1, 0)].cloudsMid));
            var CloudsMidColor2 = colorForClouds(data[i].cloudsMid);
            var CloudsMidColor3 = colorForClouds(0.5 * (data[i].cloudsMid + data[Math.min(i + 1, data.length - 1)].cloudsMid));
            cloudsMid += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                CloudsMidColor1 + ', ' + CloudsMidColor2 + ', ' + CloudsMidColor3 + ')" data-value="' + data[i].cloudsMid + '"></td>';


            // cloud low
            var CloudsLowColor1 = colorForClouds(0.5 * (data[i].cloudsLow + data[Math.max(i - 1, 0)].cloudsLow));
            var CloudsLowColor2 = colorForClouds(data[i].cloudsLow);
            var CloudsLowColor3 = colorForClouds(0.5 * (data[i].cloudsLow + data[Math.min(i + 1, data.length - 1)].cloudsLow));
            cloudsLow += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background: linear-gradient(to right, ' +
                CloudsLowColor1 + ', ' + CloudsLowColor2 + ', ' + CloudsLowColor3 + ')" data-value="' + data[i].cloudsLow + '"></td>';


            // precipitation
            t = data[i].precipitation;

            var icon = data[i].isPrecipFrozen ? 'ice' : 'wet';
            if (t <= 0.3) {
                icon += 0;
            } else if (t <= 1.0) {
                icon += 1;
            } else if (t <= 3.0) {
                icon += 2;
            } else {
                icon += 3;
            }
            
            var drop_icon = t < 0.2 ? 0 : Math.ceil(t);
            if(drop_icon > 3) drop_icon = 3;

            precipitation += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + '>' +
                '<img src="https://windy.app/widget/img/drop' + drop_icon +  '.svg">' + 
                ((t > 0.2) ? t.toFixed(1) : '-') +
                '</td>';

            // waves
            if(data[i].wavesHeight) hasWavesData = true;
            var wavesHeightVal = data[i].wavesHeight === false ? '0' : (data[i].wavesHeight / maxWavesHeight * 100);
            waves += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background-size: 80% ' + wavesHeightVal + '%">' +
                '<div style="transform: rotate(' + data[i].wavesDirection + 'deg); -webkit-transform: rotate(' + data[i].wavesDirection + 'deg)">' +
                (data[i].wavesHeight ? '&#8593;' : '') +
                '</div></td>';

            wavesHeight += '<td  data-value="' + data[i].wavesHeight + '"' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + '>-</td>';
            
            var dwp = data[i].wavesPeriod ? data[i].wavesPeriod + 's' : '-';
            wavesPeriod += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + '>' + dwp + '</td>';

            // tides
            var imageData = tideCtx.getImageData(i * tmpCnv.width, 0, (i+1) * tmpCnv.width, tmpCnv.height);
            tmpCtx.putImageData(imageData, 0, 0);
            tidesHtml += '<td' + (dayEnds ? ' class="windywidgetdayEnds"' : '') + ' style="background-image: url(' + tmpCnv.toDataURL() + ')"></td>';

        }

        dates += '</tr></table>';

        days += '</tr>';
        hours += '</tr>';
        windDirection += '</tr>';
        windSpeed += '</tr>';
        windGust += '</tr>';
        airTemp += '</tr>';
        airPres += '</tr>';
        precipitation += '</tr>';
        waves += '</tr>';
        wavesHeight += '</tr>';
        wavesPeriod += '</tr>';
        tidesHtml += '</tr>';

        document.querySelector("#widget_" + spotID + " #windywidgettable").innerHTML = '<table>' +
            days +
            hours +
            windDirection +
            windSpeed +
            windGust +
            airTemp +
            airPres +
            cloudsHigh +
            cloudsMid +
            cloudsLow +
            precipitation +
            waves +
            wavesHeight +
            wavesPeriod +
            tidesHtml +
            '</table>' +
            tideInfoHtml;

        document.querySelector('#widget_' + spotID + ' #windywidgetdates').innerHTML = dates;

        updateWind(spotID);
        updateTemp(spotID);
        updateHeight(spotID);
        showTides(tides.length && hasTidesData && !opts.hidetides, spotID);
        showWaves(hasWavesData && !opts.hidewaves, spotID);


        // slider
        document.querySelector('#widget_' + spotID + ' #windywidgetslider').style.background = 'linear-gradient(to right, ' + sliderGradient.join(', ') + ')';
        sliderGradient = null;

        var sliderKnob = document.querySelector('#widget_' + spotID + ' #windywidgetslider div');
        var table = document.querySelector('#widget_' + spotID + ' #windywidgettable table');

        function alignDays() {
            var days = document.querySelector('#widget_' + spotID + ' #windywidgettable .windywidgetdays td div');
            for (var i = 0; i < days.length; i++) {
                days[i].style.left = Math.floor(
                        Math.min(Math.max(10,
                            10 + table.parentNode.scrollLeft - (days[i].parentNode.offsetLeft - days[0].parentNode.offsetLeft)
                        ), days[i].parentNode.offsetWidth - days[i].offsetWidth - 10)
                    ) + 'px';
            }
        }

        function slide() {
            table.parentNode.scrollLeft = (table.offsetWidth - table.parentNode.offsetWidth) * sliderKnob.offsetLeft / (sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth);

            alignDays();
        }

        function down(e) {
            e.preventDefault();
            var extra = sliderKnob.offsetLeft - (e.touches ? e.touches[0].pageX : e.pageX);

            function move(e) {
                sliderKnob.style.left = Math.max(0, Math.min(sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth,
                        (e.touches ? e.touches[0].pageX : e.pageX) + extra
                    )) + 'px';

                slide();
            }

            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move);
            function up() {
                window.removeEventListener('mousemove', move);
                window.removeEventListener('touchmove', move);
            }

            window.addEventListener('mouseup', up);
            window.addEventListener('touchend', up);
            window.addEventListener('touchcancel', up);
        }

        sliderKnob.addEventListener('mousedown', down);
        sliderKnob.addEventListener('touchstart', down);

        sliderKnob.parentNode.addEventListener('mousedown', function (e) {
            if (e.target != sliderKnob) {
                sliderKnob.style.left = Math.max(0, Math.min(sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth,
                        (e.touches ? e.touches[0].pageX : e.pageX) - sliderKnob.parentNode.offsetLeft - 0.5 * sliderKnob.offsetWidth
                    )) + 'px';

                slide();
            }
        })

        function down2(e) {
            e.preventDefault();
            var extra = (e.touches ? e.touches[0].pageX : e.pageX) + table.parentNode.scrollLeft;

            function move(e) {
                table.parentNode.scrollLeft = extra - (e.touches ? e.touches[0].pageX : e.pageX);

                // update slider according to the table
                sliderKnob.style.left = Math.max(0, Math.min(sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth,
                        table.parentNode.scrollLeft * (sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth) / (table.offsetWidth - table.parentNode.offsetWidth)
                    )) + 'px';

                alignDays();
            }

            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move);
            function up() {
                window.removeEventListener('mousemove', move);
                window.removeEventListener('touchmove', move);
            }

            window.addEventListener('mouseup', up);
            window.addEventListener('touchend', up);
            window.addEventListener('touchcancel', up);
        }

        table.addEventListener('mousedown', down2);
        table.addEventListener('touchstart', down2);


        function resize() {
            sliderKnob.style.width = Math.floor(100 * table.parentNode.offsetWidth / table.offsetWidth) + '%';
            sliderKnob.style.left = Math.min(sliderKnob.offsetLeft, sliderKnob.parentNode.offsetWidth - sliderKnob.offsetWidth);

            slide();
        }

        window.addEventListener('resize', resize);
        resize();
    };

    data = document.createElement('script');
    data.onload = function(e) { 
        forecast = window['wf' + opts.appid];
        showHtmlTemplate(forecast.spotInfo, JSON.parse(forecast.data), node, opts);
        var tides = forecast.tides.length ? JSON.parse(forecast.tides) : false;
        showForecast(JSON.parse(forecast.data), tides, forecast.spotInfo.spotID);
    }
    data.type = 'text/javascript';
    data.async = 1;
    data.src = this.url + 'data.php?id=wf' + opts.appid + '&' + (opts.spotid ? 'spotID=' + opts.spotid : 'lat=' + opts.lat + '&lon=' + opts.lng );
    document.body.appendChild(data);


};

/* if(!location.href.match(/^https?:\/\/(www\.)?windy(app)?\.(loc|co|local|app)/)) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-63657223-1', 'auto');
    ga('send', 'event', 'widget1_show');
} */

var nodes = document.querySelectorAll('div[data-windywidget="forecast"]');
for(var i=0; i<nodes.length; i++) {
    if(nodes[i].dataset.appid == 's7') continue;
    WindyForecastAsync(nodes[i].dataset, nodes[i]);
}

})(window, document);
    </script>
</body>
</html>